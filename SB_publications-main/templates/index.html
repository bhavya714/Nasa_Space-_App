{% extends "base.html" %}

{% block title %}Biology Research Search Engine - Home{% endblock %}

{% block content %}
<!-- Hero/Search Section -->
<section class="search-container">
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-3">
                <i class="fas fa-dna me-3"></i>
                Biology Research Search Engine
            </h1>
            <p class="lead">
                Search through {{ stats.total_articles if stats.total_articles else '600+' }} biology research articles 
                with advanced full-text search capabilities
            </p>
        </div>
        
        <div class="search-box">
            <form method="GET" action="{{ url_for('search') }}" class="d-flex">
                <div class="input-group input-group-lg">
                    <input 
                        type="text" 
                        name="q" 
                        class="form-control" 
                        placeholder="Search for topics, keywords, or phrases..."
                        autofocus
                    >
                    <button class="btn btn-light" type="submit">
                        <i class="fas fa-search me-2"></i>Search
                    </button>
                </div>
            </form>
            
            <div class="mt-3 text-center">
                <small class="text-light">
                    Try searching for: 
                    <a href="{{ url_for('search', q='microgravity') }}" class="text-white-50">microgravity</a>,
                    <a href="{{ url_for('search', q='space biology') }}" class="text-white-50">space biology</a>,
                    <a href="{{ url_for('search', q='cell culture') }}" class="text-white-50">cell culture</a>
                </small>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
{% if stats %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-3 col-sm-6">
                <div class="card stats-card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-file-alt fa-2x mb-3 opacity-75"></i>
                        <div class="stats-number">{{ "{:,}".format(stats.total_articles) }}</div>
                        <h6 class="card-title mb-0">Total Articles</h6>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="card stats-card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-font fa-2x mb-3 opacity-75"></i>
                        <div class="stats-number">{{ "{:,}".format(stats.total_words) }}</div>
                        <h6 class="card-title mb-0">Total Words</h6>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="card stats-card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-calculator fa-2x mb-3 opacity-75"></i>
                        <div class="stats-number">{{ "{:,}".format(stats.average_words|int) }}</div>
                        <h6 class="card-title mb-0">Avg Words/Article</h6>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="card stats-card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-globe fa-2x mb-3 opacity-75"></i>
                        <div class="stats-number">{{ stats.content_types|length if stats.content_types else 2 }}</div>
                        <h6 class="card-title mb-0">Content Types</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Features Section -->
<section class="py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col">
                <h2 class="fw-bold">Powerful Search Features</h2>
                <p class="text-muted">Advanced tools to help you find exactly what you're looking for</p>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="fas fa-search fa-3x text-primary"></i>
                        </div>
                        <h5 class="card-title">Full-Text Search</h5>
                        <p class="card-text">
                            Search through the complete content of all articles, not just titles and abstracts.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="fas fa-bolt fa-3x text-warning"></i>
                        </div>
                        <h5 class="card-title">Fast Results</h5>
                        <p class="card-text">
                            Lightning-fast search results powered by SQLite FTS5 full-text search engine.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <div class="mb-3">
                            <i class="fas fa-highlight fa-3x text-success"></i>
                        </div>
                        <h5 class="card-title">Smart Highlighting</h5>
                        <p class="card-text">
                            Search terms are highlighted in context to help you quickly identify relevant content.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Recent Articles Preview -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row mb-4">
            <div class="col">
                <h3 class="fw-bold">Recent Articles</h3>
                <p class="text-muted">Explore some of the latest biology research articles in our database</p>
            </div>
            <div class="col-auto">
                <a href="{{ url_for('search') }}" class="btn btn-outline-primary">
                    View All Articles <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
        
        <div id="recent-articles">
            <!-- Articles will be loaded here via JavaScript -->
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">Loading recent articles...</p>
            </div>
        </div>
    </div>
</section>

<!-- Search Tips Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title text-center mb-4">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            Search Tips
                        </h4>
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-quote-left text-primary me-2"></i>Phrase Search</h6>
                                <p class="small text-muted">Use quotes for exact phrases: "cell division"</p>
                                
                                <h6><i class="fas fa-plus text-success me-2"></i>Multiple Terms</h6>
                                <p class="small text-muted">Use AND for all terms: protein AND synthesis</p>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-minus text-danger me-2"></i>Exclude Terms</h6>
                                <p class="small text-muted">Use NOT to exclude: biology NOT chemistry</p>
                                
                                <h6><i class="fas fa-star text-warning me-2"></i>Wildcards</h6>
                                <p class="small text-muted">Use * for partial matches: grav*</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load recent articles preview
    loadRecentArticles();
    
    // Add search examples click handlers
    document.querySelectorAll('.search-examples a').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const query = this.textContent;
            document.querySelector('input[name="q"]').value = query;
        });
    });
});

function loadRecentArticles() {
    fetch('/api/search?limit=6')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('recent-articles');
            
            if (data.results && data.results.length > 0) {
                const articlesHTML = data.results.map(article => `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card article-card h-100">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <a href="/article/${article.article_id}" class="text-decoration-none">
                                        ${truncateText(article.title, 80)}
                                    </a>
                                </h6>
                                <p class="card-text small text-muted">
                                    ${truncateText(article.snippet, 120)}
                                </p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="fas fa-file-alt me-1"></i>
                                        ${article.word_count.toLocaleString()} words
                                    </small>
                                    <span class="badge bg-primary">${article.content_type}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = `<div class="row">${articlesHTML}</div>`;
            } else {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
                        <p class="text-muted">No articles available yet. The scraping process may still be running.</p>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary">
                            Check Dashboard
                        </a>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading articles:', error);
            document.getElementById('recent-articles').innerHTML = `
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Could not load recent articles. Please try refreshing the page.
                </div>
            `;
        });
}

function truncateText(text, maxLength) {
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength).trim() + '...';
}
</script>
{% endblock %}